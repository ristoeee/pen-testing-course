# h2 Täysin Laillinen Sertifikaatti

## Tehtävässä käytetty tietokone:
* Lenovo T480s
* RAM: 16 GB
* Tallennustila: 500 GB
* OS: Windows 11 Pro
* CPU: Intel i7-8650U (8 core)

## x) Tiivistelmät

### OWASP A01 (https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

Broken Access Control
* 94% sovelluksista testaan jollain tasolla
* Yleensä pääsynhallinta bugit johtavat käyttäjän pääsyyn tietoon, joka ei oole tarkoitettu kyseiselle käyttäjälle
* yleisiä haavoittuvuuksia ovat mm. URL-osoitteen muokkaus, käyttäjäroolien väärinkäyttö sekä CORS konfigurointi puutteet
* Yleisiä tapoja suojautua ovat mm. käyttäjäroolien hallinta, logit sisäänkirjautumisista sekä hälytykset toistuvista yrityksistä kirjautua väärillä tiedoilla

### OWASP A10 (https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)

Server Side Request Forgery
* SSRF-haavoittuvuudet johtuvat yleensä siitä, ettei web sovellus tarkista URL-osoitetta hakiessaan tietoa ulkoisista resursseista
* Hyökkääjällä pääsy esimerkiksi sisäverkkoon
* SSRF riski ja vakavuus ovat kasussa johtuen koko ajan lisääntyvistä pilvipalveluista ja niiden monimutkaisista toteutuksista
* Yleisimpiä tapoja ehkäistä Network layerissä ovat mm. verkon segmentointi ja palomuurin "deny by default" konfigurointi
* ...ja Application layerissä URL:ien positive allow list, HTTP uudelleenohjauksien kieltäminen ja clientien syöttämän datan varmentaminen

## a) Totally Legit Sertificate

Tätä tehtävää varten asensin ensin Zaproxyn komennolla `sudo apt-get -y install zaproxy`

![image](https://github.com/user-attachments/assets/f251f856-cbf4-4ded-98d9-04ea5466402e)

Seuraavaksi asensin Firefox selaimeen Foxyproxyn

![image](https://github.com/user-attachments/assets/75c82201-91d6-478e-98df-9e58a70ea31c)

Esivalmisteluiden jälkeen oli aika tekaista certi, "Tools"-valikosta valitaan ensin "Options" ja sen jälkeen Network->Server Certificates. 

![image](https://github.com/user-attachments/assets/584a40ce-bd99-4f58-a332-f99c1ff128a4)

Kun Tekaistu Certi on tallennettu, lisätään se Firefoxiin:

![image](https://github.com/user-attachments/assets/d3e328c9-b426-4f43-a739-715cd6e1c3ad)

Jonka jälkeen testasin, että hakupyynnöt ilmestyvät Zappiin:

![image](https://github.com/user-attachments/assets/fe4d7ea7-316e-40c1-80b0-23a68b8e5e4b)

## b) Kettumaista

Seuraavaksi lisäsin Zapin Foxyproxyyn

![image](https://github.com/user-attachments/assets/e5b9f0e3-9e9d-4ffa-ab57-dcf9d3bf8afb)

Sekä sivut, jotka ohjataan proxyyn, jotka tässä tapauksessa olivat localhost sekä portswigger.net:

![image](https://github.com/user-attachments/assets/fc99c727-4035-421f-b6f0-846b16d593b9)

## PortSwigger

Seuraavat tehtävät tehdään SportSwigger palvelun labroissa. Ensimmäisenä on vuorossa cross-site scripting (XSS) harjoituksia, joita varten palauttelin mieleen aihetta PortSwiggerin sivustolta (https://portswigger.net/web-security/cross-site-scripting). Suurimmassa osassa labroja ratkaisu saavutetaan kutsumalla alert-funktiota. Mainitaan myös Chromen yhteensopivuudesta tässä kohtaa, johon on tehty suojaus alert-funktion kutsumista vastaan heinäkuussa 2021. Koska omassa koneessani on melko tuore Windows asennus, asensin seuraavaksi Firefoxin, jolla lähden suorittamaan tämän osion tehtäviä.

### c) Reflected XSS

Ensimmäisenä on vuorossa yksinkertainen labra, jossa pitäisi löytää haavoittuvuus sivuston "Search"-toiminnosta

![image](https://github.com/user-attachments/assets/8ff3900e-2f08-4f1e-a83d-b32e90c86c6e)

Lähdin liikkeelle kokeilemalla html-koodin toimintaa "Searh"-kenttään, joka siis pitäisi olla estettynä turvallisuus syistä. Lähdin kokeilemaan yksinkertaista bullet point-listausta: `<ul><li>testi</li></ul>` koska sen toimivuuden voi nähdä suoraan haun tuloksesta

![image](https://github.com/user-attachments/assets/6ee4ee6e-f3cc-400d-935d-63e4b519184d)

![image](https://github.com/user-attachments/assets/805e3cbe-1904-4b09-8f28-e49d0fc49238)

Yllä olevasta tuloksesta voin päätellä, että "Searh"-toiminto suorittaa html-koodia, koska haku tuloksena on bullet point-listaus. Koska kenttään voi kirjoittaa html-koodia ja sivusto myös suorittaa sen, voin myös suorittaa javascriptiä sivustolla käyttämällä `<script>funktio</script>` tägiä. Joten seuraavaksi kokeilin `<script>alert()</script>`, jolla siis kutsutaan tehtävänannossa mainittua alert-funktiota.

![image](https://github.com/user-attachments/assets/a9b8b9b7-0c51-4e59-912f-c5232059519f)

![image](https://github.com/user-attachments/assets/83027452-4377-46cc-891d-cbbcd383c557)

Kuten jälkimmäisestä screenshotista näkyy, kokeilu tuotti toivotun tuloksen ja ruutuun tuli alert-boxi. Huomion arvoista on myös osoitekentässä näkyvä osoite, jossa myös näkyy tuo scripti. Tein myös testin painamalla enteriä osoiterivillä ja lopputulos oli sama, eli ruutuun ilmestyi varoitusboxi. Näin ollen pelkän linkin lähettämällä varomaton käyttäjä voi suorittaa scriptin pelkästään klikkaamalla linkkiä. 

### d) Stored XSS

Seuraavaksi vuorossa on stored XSS, jonka tavoitteena on saastuttaa haavoittuva sivusta, jonka seurauksena jokainen sivustolla vieraileva suorittaa haitallisen koodin omassa selaimessaan (https://portswigger.net/web-security/cross-site-scripting/stored). Labrasta aukeaa seuraava sivusto

![image](https://github.com/user-attachments/assets/e6b32fc9-3e36-4b91-8a35-e96c7493ed1c)

Selailin auenneen sivuston läpi, ja siinä ei ollut mitään syöte-kenttää, joten seuraavaksi klikkasin kuvassa näkyvää "Lies"-kuvaa, koska se oli linkkinä. Sentakaa löytyi komentti-kenttä

![image](https://github.com/user-attachments/assets/647834f9-07de-44a1-9957-5d1d632ba6b4)

Lähdin jälleen kokeilemaan haavoittuvuutta ensin html-koodilla bullet point listauksella. LÖytääkseni haavoittuvuuden mahdollisiman helposti käytin kuvan mukaista tapaa, jolla pystyn testaamaan kaikki kentät yhdellä kertaa.

![image](https://github.com/user-attachments/assets/8f611a4a-daf0-48c6-91f3-53d77a53f149)

Sähköposti kentästä löytyi suojaus, joten muutin sen sen höpöhöpö osoitteeksi

![image](https://github.com/user-attachments/assets/7e6c9903-ff9c-43df-ac36-bea499fbf0a5)

![image](https://github.com/user-attachments/assets/3ddaab45-051e-4564-a6a8-52c997036c78)

Samoin kotisivu kentässä on ainakin jonkinmoinen suojaus

![image](https://github.com/user-attachments/assets/6ce1f0f0-f8c1-4a09-ad32-558338192237)

Kommentti kenttä ainakin suorittaa html-koodia lopputuloksesta päätellen. Samoin nimi kenttää muuttaa nimen kotisivu-kenttään syötetyn osoitteen linkiksi.

![image](https://github.com/user-attachments/assets/e8672ddb-8568-4671-8f99-e28a3502e431)

Seuraavaksi kokeilin syöttää kommenttikenttään alert-funktion kutsun.

![image](https://github.com/user-attachments/assets/63e716bf-0d3f-4ad6-89de-e9a6eab85dcc) 

![image](https://github.com/user-attachments/assets/593db6cc-541d-482f-ad91-5a8315ce7b29)

Kommenttini tallentui blogiin, joten klikkasin seuraavaksi "Back to blog"-linkkiä

![image](https://github.com/user-attachments/assets/e9997b70-361d-44e2-8d81-47e8b634e4c0)

Koska minulla oli kommenttikentässä pelkkä scriptin suoritus äskeisessä ja blogin kommentteihin tuli pelkkä nimi ilman kommenttia. Näin ollen scriptin mahdollistava tägi siis piilottuu automaattisesti. Jotta labran postaus olisi vakuuttavampi, kokeilin vielä seuraavaa 

![image](https://github.com/user-attachments/assets/2b660a56-8ec2-4380-a491-71536a1756d7)

Koska sivulla on nyt kolme kommenttia, joissa kussakin on tuo alert-funktion kutsu, tulee sivustolle mentäessä kolme kertaa alert-boxi ruutuun. Näin ollen jokaisella kerralla kun kyseisen blogin sivulla vieraillaan, suoritetaan nuo scriptit, jotka siis voisivat olla haitallisia.



## Lähteet


* Karvinen, Tero. Tunkeutumistestaus, 2025. https://terokarvinen.com/tunkeutumistestaus
* PortSwigger. Cross-site scripting (XSS). https://portswigger.net/web-security/cross-site-scripting
* PortSwigger. Stored XSS. https://portswigger.net/web-security/cross-site-scripting/stored
